<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tanzania Security Scanner</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
    h1 { margin: 0 0 0.25rem; }
    .meta { color: #555; margin-bottom: 1rem; }
    .entry { border: 1px solid #e7e7e7; border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem; }
    .chip { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 999px; border: 1px solid #ddd; font-size: 0.85rem; margin-right: 0.35rem; }
    .sms { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #f7f7f7; padding: 0.5rem; border-radius: 8px; overflow-x: auto; }
    .small { color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>Tanzania Security Scanner</h1>
  <div class="meta">Hourly scrape of news/advisories for Northern Tanzania (EST). Auto-refreshes every 10 minutes.</div>
  <div id="last"></div>
  <div id="list"></div>
  <p class="small">Scope: JRO, Arusha NP, A23/A104/B144 corridors, Tloma, Karatu, Ngorongoro, Serengeti (Mbali Mbali Soroi), Tarangire, Lake Manyara, + ~15mi radius. Filters: protest, unrest, riot, clashes, political, advisory, curfew, blockade, etc.</p>
  <script>
    async function load() {
      try {
        const r = await fetch('data/latest.json?_=' + Date.now());
        const j = await r.json();
        const last = new Date(j.generated_at_est);
        document.getElementById('last').innerHTML = '<div class="small">Last update: ' + last.toLocaleString('en-US', { timeZone: 'America/New_York' }) + ' (EST)</div>';
        const list = document.getElementById('list');
        list.innerHTML = '';
        if (!j.entries.length) {
          list.innerHTML = '<div class="small">No relevant items in the last 72 hours.</div>';
          return;
        }
        j.entries.forEach(e => {
          const div = document.createElement('div');
          div.className = 'entry';
          div.innerHTML = `
            <div><span class="chip">${e.when_est_hhmm}</span><span class="chip">${e.location}</span><span class="chip">${e.source_short}</span></div>
            <div style="margin: 0.25rem 0;"><strong>${e.alert}</strong></div>
            <div class="sms">${e.when_est_hhmm} | ${e.location} | ${e.alert} | ${e.source_short}</div>
            <div class="small"><a href="${e.source}" target="_blank" rel="noopener noreferrer">Full source</a></div>
          `;
          list.appendChild(div);
        });
      } catch (e) {
        document.getElementById('list').innerHTML = '<div class="small">Error loading data.</div>';
      }
    }
    load();
    setInterval(load, 10 * 60 * 1000);
  </script>
</body>
</html>
